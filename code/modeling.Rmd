---
title: "Modeling"
author: "Group 6"
output: pdf_document
---

```{r setup, include=FALSE}
# setup chunks
knitr::opts_chunk$set(echo = F, fig.align = "center", warning = F, message = F, fig.height = 4)
# load libaries
library(tidyverse)
library(grid)
library(gridExtra)
library(patchwork)
library(moderndive)
library(ISLR)
# load helper scripts
source(file = "../R/wrangle.R")
source(file = "../R/model.R")
source(file = "../R/visualization.R")
source(file = "../R/threshold.R")
# Read global header file (imports datasets and does initial wrangling)
source(file = "../R/header.R")
```

```{r}
# Split data
couldabeens_pre <- couldabeens[which(couldabeens$postMoneyball == 0),]
couldabeens_post <- couldabeens %>% anti_join(couldabeens_pre)
```

# Predictors

```{r, echo = T}
# Revenue and Labor Share
cor(couldabeens$totRev, couldabeens$labShare)
cor(couldabeens$totRev, couldabeens$totPayroll)
cor(couldabeens$totPayroll, couldabeens$labShare)
```

\newpage

# Predictor Visualization

```{r, fig.height = 2.75}
ggplot() + geom_point(data = payroll, mapping = aes(x = totRev, y = labShare, color = Year))
ggplot() + geom_point(data = payroll, mapping = aes(x = totRev, y = totPayroll, color = Year))
ggplot() + geom_point(data = payroll, mapping = aes(x = totPayroll, y = labShare, color = Year))
```

\newpage

# Linear Model: Year

```{r}
lm <- lm(prop ~ Year + postMoneyball, data = couldabeens)
summary(lm)
```

```{r}
ggplot(couldabeens, aes(x = Year, y = prop, color = factor(postMoneyball))) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE)
```

\newpage

## Diagnostic Plots: Year Linear Model

```{r, fig.height = 3.75}
plot(lm)
```


\newpage 

# Linear Model: Labor Share

```{r}
lm <- lm(prop ~ labShare, data = couldabeens_post)
summary(lm)
```

## Relationship between Labor Share and Couldabeen Rates

```{r}
col1 <- "skyblue3"
ggplot(data = couldabeens_post, mapping = aes(y = prop, x = labShare)) + 
  geom_point(color = col1) +
  geom_smooth(color = col1, se = F, method = "lm")
```

## Diagnostic Plots: Labor Share Linear Model

```{r, fig.height = 3.75}
plot(lm)
```


\newpage

## Couldabeen Rates across the Years

```{r}
col1 <- "skyblue3"
ggplot(data = couldabeens_post, mapping = aes(x = Year, y = prop, color = labShare)) + 
  geom_point() +
  geom_smooth(se = F, method = "lm") +
  scale_color_gradient(low = "red", high = "lightgreen")
```


