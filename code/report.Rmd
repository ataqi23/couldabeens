---
title: "Report"
author: "Group 6"
output: pdf_document
---

# Abstract

# Introduction

# Methods

We mainly compare the proportions of couldabeen retirees across years in different time periods. 

# Exploratory Data Analysis

```{r setup, include=FALSE}
# setup chunks
knitr::opts_chunk$set(echo = F, fig.align = "center", warning = F, message = F, fig.height = 4)
# load libaries
library(tidyverse)
library(grid)
library(gridExtra)
library(patchwork)
library(ISLR)
# load helper scripts
source(file = "R/wrangle.R")
source(file = "R/model.R")
source(file = "R/visualization.R")
source(file = "R/threshold.R")
# global parameters
bplot <- T
bloud <- T
bhead <- T
```

The Data

```{r, cache = T}
# Load rookies datasets
df_pit_rkes <- read_csv("data/rookie-pitcher.csv")
df_pos_rkes <- read_csv("data/rookie-position.csv")
# Load retirees datasets
df_pit_ret <- read_csv("data/retirees-pitcher.csv")
df_pos_ret <- read_csv("data/retirees-position.csv")
# Find number of retirees by year
num_retirees <- total_retirees_by_yr(df_pit_ret, df_pos_ret)
num_retirees <- data.frame(retirees = num_retirees$retirees)
# Create list of datasets for ease of function input
ls_datasets <- list(df_pos_rkes, df_pos_ret, df_pit_rkes, df_pit_ret, num_retirees)
# Obtain number of couldabeens
couldabeens <- couldabeens_by_threshold(ls_datasets)
# Obtain wrangled rookie datasets
pit_rkes <- wrangle_init(df_pit_rkes)
pos_rkes <- wrangle_init(df_pos_rkes)
# read in the classified retiree data
pos_ret <- read_csv("data-report/pos_ret_classified.csv")
pit_ret <- read_csv("data-report/pit_ret_classified.csv")
# combine them into one dataframe
retirees <- prep_booleans(rbind(pos_ret, pit_ret))
```

Our data comes from baseball-reference.com and we mainly have four sets of data.

1. Rookie pitchers
2. Rookie positions
3. Retired pitchers
4. Retired positions

Then we compare the ratio of couldabeens from the retirees pool over two different time periods, 1969-2002 and 2003-2018. 


Here are our models

```{r, fig.height = 4}
# Density plot of rookie and retired pitchers 
pitcher_density <- ggplot() +
  geom_density(data = pit_ret, aes_string(x = "WAR"), color = "salmon") +
  geom_density(data = pit_rkes, aes_string(x = "WAR"), color = "skyblue3") +
  geom_vline(xintercept = median(pit_rkes$WAR), color = "skyblue3") +
  labs(title = "Pitchers")
# Density plot of rookie position players and retired position players 
position_density <- ggplot() +
  geom_density(data = pos_ret, aes_string(x = "WAR"), color = "salmon") +
  geom_density(data = pos_rkes, aes_string(x = "WAR"), color = "skyblue3") +
  geom_vline(xintercept = median(pos_rkes$WAR), color = "skyblue3") +
  labs(title = "Position")
# Plot
if(bplot){grid.arrange(pitcher_density, position_density, nrow = 2)}
```

\newpage

## First Look: A Logistic Model

```{r}
# Partition retirees into pre-rule and post-rule era
retirees_pre <- prerule(retirees)
retirees_post <- postrule(retirees)
```

```{r, fig.width = 6, fig.height = 4}
# On the retirees pre-rule dataset
dataset <- retirees_pre
if(bplot){plot_logmodel(dataset, "Retirees Above and Below Threshold (Pre-rule)")}
model_log <- logistic_model(dataset)
if(bloud){summary(model_log)}
```


```{r, fig.width = 6, fig.height = 4}
# On the retirees pre-rule dataset
dataset <- retirees_post
if(bplot){plot_logmodel(dataset, "Retirees Above and Below Threshold (Post-rule)")}
model_log <- logistic_model(dataset)
if(bloud){summary(model_log)}
```

\newpage

# Computing Retiree Proportions

Here is what the proportion-appended couldabeen dataframe looks like:

```{r, echo = F}
if(bhead){head(couldabeens)}
```

\newpage

# Year as Predictor: Linear Modeling

```{r, echo = T}
# Partition dataset into years before and after rule
couldabeens_pre <- prerule(couldabeens)
couldabeens_post <- postrule(couldabeens)
```

```{r, echo = T}
# Obtain linear model for pre-rule years
model_pre <- lm(formula = prop ~ I(Year), data = couldabeens_pre)
coefs_pre <- model_pre$coefficients
# Obtain linear model for post-rule years
model_post <- lm(formula = prop ~ I(Year), data = couldabeens_post)
coefs_post <- model_post$coefficients
```

```{r, echo = T}
# Obtain linear model for all years
model_comp <- lm(formula = prop ~ I(Year), data = couldabeens)
coefs_comp <- model_comp$coefficients
```

\newpage

# Results


## Couldabeens: A Comprehensive Look

```{r}
col1 <- "salmon"
col2 <- "skyblue2"
# Plot proportion of couldabeens in post-rule era ()
plot_comp <- scatter_props(couldabeens, title = "Proportion of Couldabeen Retirees") +
    geom_point(data = couldabeens_pre, mapping = aes(x = Year, y = prop), color = col1) +
    geom_abline(slope = coefs_pre[2], intercept = coefs_pre[1], color = col1) +
    geom_point(data = couldabeens_post, mapping = aes(x = Year, y = prop),color = col2) +
    geom_abline(slope = coefs_post[2], intercept = coefs_post[1], color = col2) + 
    labs(y = "Proportion")
plot_comp
```


\newpage

## Simpson's Paradox

```{r}
if(bloud){summary(model_comp)}
```

```{r}
col <- "violet"
col1 <- "salmon"
col2 <- "skyblue2"
# Plot proportion of couldabeens in post-rule era ()
plot_comp <- scatter_props(couldabeens, title = "Proportion of Couldabeen Retirees") +
    geom_abline(slope = coefs_comp[2], intercept = coefs_comp[1], color = col) + 
    geom_point(data = couldabeens_pre, mapping = aes(x = Year, y = prop), color = col1) +
    geom_abline(slope = coefs_pre[2], intercept = coefs_pre[1], color = col1) +
    geom_point(data = couldabeens_post, mapping = aes(x = Year, y = prop),color = col2) +
    geom_abline(slope = coefs_post[2], intercept = coefs_post[1], color = col2) + 
    labs(y = "Proportion")
plot_comp
```

\newpage

## Couldabeens: Pre-rule Era (1969-2002)

```{r}
if(bloud){summary(model_pre)}
```

\bigskip
\bigskip

```{r, fig.cap= "Proportion of Retirees who were Coulabeens prior to the implementation of the Luxury Tax"}
# Plot proportion of couldabeens in pre-rule era ()
plot_pre <- plot_props_linear(couldabeens_pre, coefs_pre, color = "salmon", 
                              title = "Proportion of Couldabeen Retirees (1969-2002)")
plot_pre
```

\newpage

## Couldabeens: Post-rule Era (2003-2018)

```{r}
if(bloud){summary(model_post)}
```

\bigskip
\bigskip

```{r, fig.cap= "Proportion of Retirees who were Coulabeens after the implementation of the Luxury Tax"}
# Plot proportion of couldabeens in post-rule era ()
plot_post <- plot_props_linear(couldabeens_post, coefs_post, color = "skyblue2", 
                               title = "Proportion of Couldabeen Retirees (2003-2018)")
plot_post
```






# Discussion



# Code Appendix



# References

add source: baseball-reference.com









