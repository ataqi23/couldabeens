---
title: "Statistical Learning: Project Presentation"
author: "G. Dunlavey, W. Ren, A. Taqi"
output:
  beamer_presentation:
    theme: "AnnArbor"
    colortheme: "dolphin"
    fonttheme: "structurebold"
header-includes:
  - \newcommand{\R}{\mathbb{R}}
---

```{r setup, include=FALSE}
# setup chunks
knitr::opts_chunk$set(echo = F, fig.align = "center", warning = F, message = F, fig.height = 4)
# load libaries
library(tidyverse)
library(knitr)
library(grid)
library(gridExtra)
library(patchwork)
library(moderndive)
library(ggrepel)
library(ISLR)
# Read global header file (imports datasets and does initial wrangling)
source(file = "R/header.R")
source(file = "R/presentation.R")
```

# Visualization: Couldabeen Classification

```{r, fig.height = 3, fig.width = 5}
if(bplot){grid.arrange(dens_pit, dens_pos, nrow = 2)}
```

# Methods: Modeling

 **Linear Model:** After classifying all retired players, get proportion of "couldbaeen" retirees and call this `prop`.
 
- As such, we now have $50$ data points (for each year), so we run a linear model fitting `Year ~ prop`.
- Because there will always be "couldabeens", we do not expect a large effect size and hence a very significant result.
- If our research hypothesis is correct (that there is an effect), we expect to see a positive coefficient for $\beta_{Year}$.

# Linear model (Year + post-Moneyball)

```{r,echo = F}
ggplot(couldabeens, aes(x = Year, y = prop, color = factor(postMoneyball))) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE)
```

# Linear model (Year + post-Moneyball)

- $\beta_{Year} = 0.002695$. This coefficient is not statistically with a high P-value of $0.170$.

- $\beta_{postMoneyball} = -0.130262$. This coefficient is statistically significant with a low P-value of $0.00052$.


# Linear model (pre-Moneyball)

```{r}
ggplot(couldabeens_pre, aes(x = Year, y = prop)) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE)
```


# Linear model (pre-Moneyball)

- $\beta_{Year} = 0.003357$. This coefficient is not statistically with a high P-value of $0.300$.

# Linear model (post-Moneyball)

```{r}
ggplot(data = couldabeens_post, mapping = aes(y = prop, x = labShare)) + 
  geom_point(color = col1) +
  geom_smooth(color = col1, se = F, method = "lm")
```


# Linear model (post-Moneyball)

- $\beta_{Year} = 0.002034$. This coefficient is not statistically with a high P-value of $0.398$.



# Simpson's Paradox

- We chose to partition the dataset into the post-rule and pre-rule eras and fit a linear model `Year ~ prop`.
- In both partitions, we find that the parameter $\beta_{Year} > 0$. 
- However, if we do not make the partition, we find that $\beta_{Year} \approx 0$. 
- This raises some questions regarding the role our partition plays in our inference and modeling choices. 
- In fact, this is *Simpson's Paradox*.

```{r, echo = F}
# Obtain linear model for all years
model_comp <- lm(formula = prop ~ I(Year), data = couldabeens)
coefs_comp <- model_comp$coefficients
```

# Simpson's Paradox

```{r, fig.height = 2.75}
col <- "mediumvioletred"
col1 <- "salmon"
col2 <- "skyblue2"
# Plot proportion of couldabeens in post-rule era ()
scatter_props(couldabeens, title = "Proportion of Couldabeen Retirees") +
    geom_abline(slope = coefs_comp[2], intercept = coefs_comp[1], color = col) + 
    geom_point(data = couldabeens_pre, mapping = aes(x = Year, y = prop), color = col1) +
    geom_abline(slope = coefs_pre[2], intercept = coefs_pre[1], color = col1) +
    geom_point(data = couldabeens_post, mapping = aes(x = Year, y = prop),color = col2) +
    geom_abline(slope = coefs_post[2], intercept = coefs_post[1], color = col2) + 
    labs(y = "Proportion")
```

# Threshold Stability

Recall the definition of the Couldabeen classifier: 

## The General Couldabeen Classifier

Given a threshold $t \in \mathbb{R}$, we construct the corrosponding classifier for "couldabeen" status $C$ of a given retired player $p$ (from the year $Y$) to be as follows:
\[
C(p) = \begin{cases}
True, \,  \text{WAR}_p \geq \mu_Y + t\sigma_Y \\
False, \, \text{WAR}_p < \mu_Y + t\sigma_Y
\end{cases}
\]

# Threshold Stability

- Analyze the effects of the threshold $t$ on the impact of our $\beta_{\text{Year}}$ fitting the linear models. 
- Our inference relies on $\beta_{\text{Year}}$ being positive for any $t \in \R$. 
- Obtained a supporting result for $\beta_{Year}$ for only a particular threshold ($t = 0$) in the post-rule era. 
- Varying the threshold tells another story.
- Run a linear model with `Year ~ prop` against a varying threshold $t \in \mathbb{R}$.
- Found that $\beta_{Year}$ is quite unstable.

# Threshold Stability

```{r, out.width= "80%", fig.cap = "Parameters of the Linear Model against varying threshold for couldabeen status"}
include_graphics("images/coef.jpeg")
```

# Threshold Stability: Possible Adjustments

- Thresholds every year were calculated as a function of *only* that year's data. 
- So, the sample from which we obtain the threshold by each level (corrosponding to each year) is very small meaning small changes to the threshold cause high levels of noise in our final model. 
- To treat this problem, we may consider "smoothing" the threshold out by taking the data of that year and adjacent years. 
For instance, instead of considering just 2018 data, we may take 2017-2019 data for a "window length of 1". 
- Furthermore, the addition of some supplementary yearly salary/budgets data may be useful as another predictor since `Year` alone does not seem to have good explanatory power.

# References

(1) https://stathead.com/baseball/
(2) Bradbury, John Charles. “What Explains Labor's Declining Share of Revenue in Major League Baseball?” (2019).
(3) https://blogs.fangraphs.com/mlbs-evolving-luxury-tax/


